<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C Command Line Arguments (argc/argv) Visualizer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fb;
        }
        .container-card {
            box-shadow: 0 10px 25px -3px rgba(0, 0, 0, 0.05), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease;
        }
        .pointer-line {
            transition: all 0.5s ease-out;
            fill: none;
            stroke-width: 2;
            stroke-linecap: round;
        }
        /* Custom scrollbar for output area */
        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-thumb { background-color: #9ca3af; border-radius: 3px; }
        .custom-scroll::-webkit-scrollbar-track { background-color: #e5e7eb; }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-6xl mx-auto">
        <header class="text-center mb-10">
            <h1 class="text-4xl md:text-5xl font-extrabold text-gray-800 mb-2">
                <span class="text-indigo-600">C Command Line</span> Arguments Visualizer
            </h1>
            <p class="text-lg text-gray-500">
                Explore the relationship between <code class="bg-gray-200 px-1 rounded text-sm text-indigo-700">argc</code> and <code class="bg-gray-200 px-1 rounded text-sm text-indigo-700">argv</code>.
            </p>
        </header>

        <!-- Interactive Visualization Area -->
        <section class="mb-12 p-6 bg-white rounded-xl container-card">
            <h2 class="text-2xl font-bold text-gray-700 mb-4 border-b pb-2">1. Interactive Command Input</h2>

            <div class="space-y-4">
                <label for="commandInput" class="block text-sm font-medium text-gray-700">Simulate Command Line Execution:</label>
                <div class="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-3">
                    <input type="text" id="commandInput" value="./program hello 123 world"
                        class="flex-grow p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 text-gray-900 shadow-sm"
                        placeholder="./program arg1 arg2 ..."
                        onkeypress="if(event.key === 'Enter') visualizeArgs()">
                    <button onclick="visualizeArgs()"
                        class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 px-6 rounded-lg shadow-md transition duration-150 ease-in-out transform hover:scale-[1.02]">
                        <svg class="w-5 h-5 inline mr-2 -mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v14H9z"></path></svg>
                        Visualize
                    </button>
                </div>
            </div>

            <div id="output" class="mt-6 p-4 bg-gray-50 border border-gray-200 rounded-lg text-sm custom-scroll overflow-auto" style="min-height: 100px;">
                <p class="text-gray-500">Enter a command and click "Visualize" to see the output and memory map.</p>
            </div>

            <!-- Visualization Area -->
            <div class="mt-8">
                <h3 class="text-xl font-semibold text-gray-700 mb-4">Memory Concept Visualization</h3>
                <div class="flex flex-col md:flex-row md:space-x-8">
                    <!-- ARG V Array (Pointers) -->
                    <div class="w-full md:w-1/3 mb-6 md:mb-0">
                        <p class="font-mono text-center text-lg mb-2 text-indigo-600 font-bold">argv (char**)</p>
                        <div id="argv-array" class="space-y-2 p-3 bg-indigo-50 border border-indigo-200 rounded-lg min-h-[200px] relative">
                            <!-- Pointers will be inserted here -->
                        </div>
                    </div>

                    <!-- Pointers SVG Canvas -->
                    <div class="w-full md:w-2/3">
                        <p class="font-mono text-center text-lg mb-2 text-green-600 font-bold">Strings (char arrays)</p>
                        <div class="relative p-3 bg-green-50 border border-green-200 rounded-lg min-h-[200px]">
                            <svg id="pointer-svg" class="absolute inset-0 w-full h-full pointer-events-none z-10"></svg>
                            <div id="string-memory" class="space-y-3 relative z-20">
                                <!-- Strings will be inserted here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Static Explanation Area 1 -->
        <section class="p-6 bg-white rounded-xl container-card mb-12">
            <h2 class="text-2xl font-bold text-gray-700 mb-4 border-b pb-2">2. Key Concepts & Definitions</h2>

            <div class="grid md:grid-cols-2 gap-8">
                <!-- Argc & Argv Definition -->
                <div>
                    <h3 class="text-xl font-semibold text-indigo-600 mb-3">The main Function Signature</h3>
                    <pre class="bg-gray-100 p-3 rounded-lg text-sm overflow-x-auto text-gray-800 mb-4"><code>int main(int argc, char *argv[])</code></pre>
                    <ul class="space-y-3 text-gray-600">
                        <li>
                            <p class="font-semibold text-gray-800">argc (Argument Count):</p>
                            <p>The **number of command-line arguments** passed to the program, including the program's name itself.</p>
                        </li>
                        <li>
                            <p class="font-semibold text-gray-800">argv (Argument Vector):</p>
                            <p>An **array of pointers to strings** (<code class="bg-gray-200 px-1 rounded text-sm text-indigo-700">char *</code>) where each string is one command-line argument.</p>
                        </li>
                    </ul>
                </div>

                <!-- Accessing & Conversion -->
                <div>
                    <h3 class="text-xl font-semibold text-indigo-600 mb-3">Accessing and Conversion</h3>
                    <ul class="space-y-3 text-gray-600">
                        <li>
                            <p class="font-semibold text-gray-800">The Program Name:</p>
                            <p><code class="bg-gray-200 px-1 rounded text-sm text-indigo-700">argv[0]</code> is **always** the name or path of the executed program.</p>
                        </li>
                        <li>
                            <p class="font-semibold text-gray-800">Arguments Start at Index 1:</p>
                            <p>Actual user arguments begin at <code class="bg-gray-200 px-1 rounded text-sm text-indigo-700">argv[1]</code> and continue up to <code class="bg-gray-200 px-1 rounded text-sm text-indigo-700">argv[argc - 1]</code>.</p>
                        </li>
                        <li>
                            <p class="font-semibold text-gray-800">Conversion is Required:</p>
                            <p>All arguments are passed as **strings**. To use them as numbers, you must convert them using functions like <code class="bg-gray-200 px-1 rounded text-sm text-indigo-700">atoi()</code>, <code class="bg-gray-200 px-1 rounded text-sm text-indigo-700">atof()</code>, or the safer <code class="bg-gray-200 px-1 rounded text-sm text-indigo-700">strtol()</code>.</p>
                        </li>
                        <li>
                            <p class="font-semibold text-gray-800">NULL Terminator:</p>
                            <p>By convention, <code class="bg-gray-200 px-1 rounded text-sm text-indigo-700">argv[argc]</code> is guaranteed to be a <code class="bg-gray-200 px-1 rounded text-sm text-indigo-700">NULL</code> pointer.</p>
                        </li>
                    </ul>
                </div>
            </div>

            <h3 class="text-xl font-semibold text-indigo-600 mt-8 mb-3 border-t pt-4">Difference from scanf()</h3>
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200 rounded-lg border border-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Feature</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">scanf()</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">argc/argv</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        <tr>
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Input Type</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">Interactive input during runtime (reads from stdin)</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">Command-line arguments passed before program starts</td>
                        </tr>
                        <tr>
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Conversion</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">Handled automatically via format specifiers (e.g., <code class="bg-gray-200 px-1 rounded text-sm text-indigo-700">%d</code>)</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">Manual conversion required (e.g., <code class="bg-gray-200 px-1 rounded text-sm text-indigo-700">atoi()</code>)</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Static Explanation Area 2: Advanced Concepts -->
        <section class="p-6 bg-white rounded-xl container-card">
            <h2 class="text-2xl font-bold text-gray-700 mb-4 border-b pb-2">3. Advanced Usage and Robustness</h2>
            
            <div class="grid md:grid-cols-2 gap-8 mt-4">

                <!-- 3A: Robustness and Validation -->
                <div class="p-5 bg-gray-50 rounded-lg border border-gray-200">
                    <h3 class="text-xl font-bold text-red-600 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>
                        Robust Input Validation
                    </h3>
                    
                    <ul class="space-y-4 text-gray-600 text-sm">
                        <li>
                            <p class="font-semibold text-gray-800">Count Check (<code class="bg-gray-200 px-1 rounded text-sm text-indigo-700">argc</code>):</p>
                            <p>Prevent **segmentation faults** by ensuring the user provided the required number of arguments before accessing <code class="bg-gray-200 px-1 rounded text-sm text-indigo-700">argv</code> indices.</p>
                            <pre class="bg-red-50 text-red-800 p-2 rounded-lg text-xs overflow-x-auto mt-2 border border-red-200"><code>if (argc != 3) {
    fprintf(stderr, "Usage: %s &lt;num1&gt; &lt;num2&gt;\\n", argv[0]);
    return 1;
}</code></pre>
                        </li>
                        <li>
                            <p class="font-semibold text-gray-800">Safer Conversion (<code class="bg-gray-200 px-1 rounded text-sm text-indigo-700">strtol</code>):</p>
                            <p>Avoid <code class="bg-gray-200 px-1 rounded text-sm text-indigo-700">atoi()</code>, which provides no error feedback. **strtol** checks if conversion was successful and handles overflow.</p>
                            <pre class="bg-red-50 text-red-800 p-2 rounded-lg text-xs overflow-x-auto mt-2 border border-red-200"><code>char *endptr;
long num = strtol(argv[1], &endptr, 10);
if (*endptr != '\\0' || argv[1] == endptr) {
    // Error: Non-numeric input or empty string
}</code></pre>
                        </li>
                    </ul>
                </div>

                <!-- 3B: Environment Variables -->
                <div class="p-5 bg-gray-50 rounded-lg border border-gray-200">
                    <h3 class="text-xl font-bold text-teal-600 mb-3 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 01-9 9m-9-9a9 9 0 019-9m0 18c-2.485 0-4.5-2.015-4.5-4.5S9.515 12 12 12s4.5 2.015 4.5 4.5S14.485 21 12 21zm0-18C9.515 3 7.5 5.015 7.5 7.5S9.515 12 12 12s4.5-2.015 4.5-4.5S14.485 3 12 3z"></path></svg>
                        Accessing Environment Variables (envp)
                    </h3>
                    <ul class="space-y-4 text-gray-600 text-sm">
                        <li>
                            <p class="font-semibold text-gray-800">The Third Argument:</p>
                            <p>The <code class="bg-gray-200 px-1 rounded text-sm text-indigo-700">main</code> function can accept a third argument: <code class="bg-gray-200 px-1 rounded text-sm text-indigo-700">char *envp[]</code>. This array holds system-wide settings like <span class="font-mono text-xs text-green-700">PATH</span> or <span class="font-mono text-xs text-green-700">HOME</span>.</p>
                        </li>
                        <li>
                            <p class="font-semibold text-gray-800">Full Signature & Structure:</p>
                            <p>The **Full Signature** (below) shows all three arguments. Like <code class="bg-gray-200 px-1 rounded text-sm text-indigo-700">argv</code>, <code class="bg-gray-200 px-1 rounded text-sm text-indigo-700">envp</code> is an array of pointers to <span class="font-mono text-xs text-green-700">KEY=VALUE</span> strings and is **NULL-terminated**.</p>
                        </li>
                    </ul>
                    <div class="mt-4 pt-3 border-t border-teal-200">
                        <p class="font-semibold text-gray-800 mb-2">Full main Signature</p>
                        <pre class="bg-teal-50 text-teal-800 p-2 rounded-lg text-xs overflow-x-auto border border-teal-200"><code>int main(int argc, char *argv[], char *envp[]) {
    // ... code here ...
}</code></pre>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <script>
        // Global utility to generate a unique ID
        const generateId = () => 'id-' + Math.random().toString(36).substring(2, 9);

        // Function to visualize the arguments
        function visualizeArgs() {
            const input = document.getElementById('commandInput').value.trim();
            const outputDiv = document.getElementById('output');
            const argvArrayDiv = document.getElementById('argv-array');
            const stringMemoryDiv = document.getElementById('string-memory');
            const pointerSvg = document.getElementById('pointer-svg');

            // 1. Tokenize the input string
            // Use a simple split by space, handling quoted arguments
            const args = input.match(/"[^"]+"|'[^']+'|\S+/g) || [];
            
            // Clean up surrounding quotes from quoted arguments
            const processedArgs = args.map(arg => {
                const quoteMatch = arg.match(/^['"](.*)['"]$/);
                return quoteMatch ? quoteMatch[1] : arg;
            });
            
            const argc = processedArgs.length;

            // 2. Display the C output simulation
            let outputHtml = `<p class="font-bold text-lg text-indigo-700 mb-3">Simulated C Output:</p>`;
            outputHtml += `<div class="font-mono bg-white p-3 rounded-md border border-dashed border-indigo-300">`;
            outputHtml += `<p class="text-gray-900">argc = ${argc}</p>`;
            if (argc === 0) {
                outputHtml += `<p class="text-red-500">No command entered. argc is 0.</p>`;
            } else {
                processedArgs.forEach((arg, index) => {
                    outputHtml += `<p class="text-gray-800">argv[${index}] = <span class="text-green-600">"${arg}"</span></p>`;
                });
            }
            outputHtml += `</div>`;
            outputDiv.innerHTML = outputHtml;


            // 3. Clear existing visualization elements
            argvArrayDiv.innerHTML = '';
            stringMemoryDiv.innerHTML = '';
            pointerSvg.innerHTML = '';

            if (argc === 0) return;

            // 4. Build the ARG V array (pointers) and STRING memory blocks
            const argElements = [];
            let argvHtml = '';
            let stringHtml = '';
            
            // Generate elements for argc arguments + 1 (for NULL)
            for (let i = 0; i <= argc; i++) {
                const isNull = i === argc;
                const argValue = isNull ? 'NULL' : processedArgs[i];
                const pointerId = generateId();
                const stringId = generateId();

                if (!isNull) {
                    // ARG V Array element (Pointer)
                    argvHtml += `
                        <div id="${pointerId}" data-target-id="${stringId}" data-index="${i}"
                             class="flex justify-between items-center p-2 rounded-lg bg-indigo-100 border border-indigo-300 transition duration-300 ease-in-out">
                            <span class="font-mono text-sm text-gray-700">argv[${i}]</span>
                            <span class="font-mono text-xs text-indigo-700 italic">0x${(Math.random() * 0xFFFFFF).toString(16).substring(0, 5).toUpperCase()}</span>
                        </div>
                    `;

                    // STRING Memory element
                    stringHtml += `
                        <div id="${stringId}" data-index="${i}"
                             class="flex flex-col p-2 rounded-lg bg-green-100 border border-green-300 transition duration-300 ease-in-out">
                            <span class="font-mono text-xs text-gray-600 mb-1">String ${i} Address</span>
                            <div class="flex items-center space-x-1 overflow-x-auto">
                                <span class="bg-white px-1 rounded text-sm text-gray-800 font-mono flex-shrink-0">${argValue}</span>
                                <span class="bg-red-200 px-1 rounded text-sm text-gray-800 font-mono flex-shrink-0">\\0</span>
                            </div>
                        </div>
                    `;
                } else {
                     // NULL pointer at the end of argv
                    argvHtml += `
                        <div class="flex justify-between items-center p-2 rounded-lg bg-red-100 border border-red-300 opacity-70">
                            <span class="font-mono text-sm text-gray-700">argv[${i}]</span>
                            <span class="font-mono text-xs text-red-700 italic font-bold">NULL</span>
                        </div>
                    `;
                }
            }

            argvArrayDiv.innerHTML = argvHtml;
            stringMemoryDiv.innerHTML = stringHtml;

            // 5. Draw the connecting lines (pointers)
            drawPointers(argc);
        }


        // Function to draw SVG lines connecting pointers to strings
        function drawPointers(argc) {
            const pointerSvg = document.getElementById('pointer-svg');
            const argvArrayDiv = document.getElementById('argv-array');
            const stringMemoryDiv = document.getElementById('string-memory');
            
            if (argc === 0) return;

            // 1. Set SVG size to match the container
            const svgRect = pointerSvg.parentElement.getBoundingClientRect();
            pointerSvg.setAttribute('width', svgRect.width);
            pointerSvg.setAttribute('height', svgRect.height);

            const argvElements = argvArrayDiv.querySelectorAll('[data-target-id]');
            let svgPaths = '';

            argvElements.forEach((ptrElement) => {
                const targetId = ptrElement.dataset.targetId;
                const targetElement = document.getElementById(targetId);

                if (!targetElement) return;

                // --- Positioning Logic ---

                // Get bounding boxes relative to the viewport
                const vizContainer = argvArrayDiv.parentElement.getBoundingClientRect();
                const ptrRect = ptrElement.getBoundingClientRect();
                const argvRect = argvArrayDiv.getBoundingClientRect();
                const targetRect = targetElement.getBoundingClientRect();
                const stringContainerRect = stringMemoryDiv.parentElement.getBoundingClientRect();


                // Y coordinates relative to the top of the entire visualization container
                const ptrCenterY = ptrRect.top + ptrRect.height/2 - vizContainer.top;
                const stringCenterY = targetRect.top + targetRect.height/2 - vizContainer.top;

                // X coordinates relative to the left of the entire visualization container
                const ptrRightX = argvRect.left + argvRect.width - vizContainer.left;
                const stringLeftX = stringContainerRect.left - vizContainer.left;
                
                // P1: Right edge of argv box
                const x1 = ptrRightX;
                const y1 = ptrCenterY;

                // P2: Midpoint X (in the gap between the two boxes)
                const midX = (stringLeftX + ptrRightX) / 2;
                
                // P3: Left edge of string box
                const x2 = stringLeftX;
                const y2 = stringCenterY;

                // Draw an L-shaped polyline (P1 -> Horizontal bend at midX, Y1 -> Vertical line at midX, Y2 -> P3)
                svgPaths += `
                    <polyline class="pointer-line stroke-indigo-500"
                        points="${x1},${y1} ${midX},${y1} ${midX},${y2} ${x2},${y2}" />
                `;
            });

            pointerSvg.innerHTML = svgPaths;
        }

        // Initialize visualization on load
        window.onload = function() {
            visualizeArgs();
            
            // Re-draw pointers on resize to maintain correct connections
            window.addEventListener('resize', () => {
                // Determine argc by checking the number of string memory blocks
                const argc = document.getElementById('string-memory').children.length;
                if (argc > 0) {
                    drawPointers(argc);
                }
            });
        };
    </script>
</body>
</html>
